<app-loader *ngIf="isLoading"></app-loader>
<app-notification #notification></app-notification>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-12 col-sm-8 col-md-6 col-lg-8">
      <div class="border rounded p-4 login-card">
        <h3 class="text-center">Registrati</h3>
        <form (ngSubmit)="register()" [formGroup]="registerForm">
          <div class="row">
            <!-- Left Column -->
            <div class="col-md-6">
              <!-- First Name -->
              <div class="form-outline mb-4">
                <label class="form-label" for="firstName">Nome</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="firstName"
                  id="firstName"
                  placeholder="Inserisci il tuo nome"
                />
                <small
                  *ngIf="
                    registerForm.get('firstName')?.touched &&
                    registerForm.get('firstName')?.hasError('required')
                  "
                  class="text-danger position-absolute"
                  >Nome è obbligatorio</small
                >
              </div>

              <!-- Last Name -->
              <div class="form-outline mb-4">
                <label class="form-label" for="lastName">Cognome</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="lastName"
                  id="lastName"
                  placeholder="Inserisci il tuo cognome"
                />
                <small
                  *ngIf="
                    registerForm.get('lastName')?.touched &&
                    registerForm.get('lastName')?.hasError('required')
                  "
                  class="text-danger position-absolute"
                  >Cognome è obbligatorio</small
                >
              </div>

              <!-- Username -->
              <div class="form-outline mb-4">
                <label class="form-label" for="username">Email</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="username"
                  id="username"
                  placeholder="Inserisci la tua email"
                />
                <small
                  *ngIf="
                    registerForm.get('username')?.touched &&
                    registerForm.get('username')?.hasError('required')
                  "
                  class="text-danger position-absolute"
                  >Email è obbligatoria</small
                >
                <small
                  *ngIf="
                    registerForm.get('username')?.touched &&
                    registerForm.get('username')?.hasError('invalidEmail')
                  "
                  class="text-danger position-absolute"
                  >Email invalida</small
                >
              </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-6">
              <!-- Password -->
              <!-- Password -->
              <div class="form-outline mb-4">
                <label class="form-label" for="password">Password</label>
                <div class="input-group">
                  <input
                    [type]="passwordVisible ? 'text' : 'password'"
                    class="form-control"
                    formControlName="password"
                    id="password"
                    placeholder="Inserisci la tua password"
                  />
                  <span
                    class="input-group-text"
                    (click)="togglePasswordVisibility('password')"
                  >
                    <i
                      class="bi"
                      [ngClass]="!passwordVisible ? 'bi-eye-slash' : 'bi-eye'"
                    ></i>
                  </span>
                </div>
                <small
                  *ngIf="
                    registerForm.get('password')?.touched &&
                    registerForm.get('password')?.hasError('required')
                  "
                  class="text-danger"
                >
                  Password è obbligatoria
                </small>
                <small
                  *ngIf="
                    registerForm.get('password')?.touched &&
                    registerForm.get('password')?.hasError('weakPassword')
                  "
                  class="text-danger"
                >
                  Almeno 8 caratteri, 1 lettera maiuscola, 1 numero e 1
                  carattere speciale
                </small>
              </div>

              <!-- Confirm Password -->
              <div class="form-outline mb-4">
                <label class="form-label" for="confirmPassword"
                  >Conferma Password</label
                >
                <div class="input-group">
                  <input
                    [type]="confirmPasswordVisible ? 'text' : 'password'"
                    class="form-control"
                    formControlName="confirmPassword"
                    id="confirmPassword"
                    placeholder="Conferma la tua password"
                  />
                  <span
                    class="input-group-text"
                    (click)="togglePasswordVisibility('confirmPassword')"
                  >
                    <i
                      class="bi"
                      [ngClass]="
                        !confirmPasswordVisible ? 'bi-eye-slash' : 'bi-eye'
                      "
                    ></i>
                  </span>
                </div>
                <small
                  *ngIf="
                    registerForm.get('confirmPassword')?.touched &&
                    registerForm.get('confirmPassword')?.hasError('required')
                  "
                  class="text-danger"
                >
                  Conferma Password è obbligatoria
                </small>
                <small
                  *ngIf="
                    registerForm.get('confirmPassword')?.touched &&
                    registerForm
                      .get('confirmPassword')
                      ?.hasError('passwordMismatch')
                  "
                  class="text-danger"
                >
                  Le Password non sono uguali
                </small>
              </div>

              <!-- Profile Picture -->
              <div class="form-outline mb-4">
                <label class="form-label" for="picture">Immagine Profilo</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="picture"
                  placeholder="Inserisci l'URL dell'immagine"
                  id="picture"
                />
                <small
                  *ngIf="
                    registerForm.get('picture')?.touched &&
                    registerForm.get('picture')?.hasError('invalidUrl')
                  "
                  class="text-danger position-absolute"
                  >Inserisci un URL valido</small
                >
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button
              type="submit"
              class="btn btn-primary btn-block mb-4"
              [disabled]="registerForm.invalid"
            >
              Registrati
            </button>
          </div>

          <div class="mt-3 text-center">
            <p>
              Hai già un account?
              <a class="register-form" [routerLink]="['/login']">Accedi</a>
            </p>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
